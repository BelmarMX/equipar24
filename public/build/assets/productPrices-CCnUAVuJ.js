import{D as d}from"./common-CQF4xCex.js";import{A as r}from"./alerts-ClLvi9ZR.js";import{a as n}from"./axios-CCb-kr4I.js";import"./sweetalert2.esm.all-Br4OTrmy.js";const c=o=>{o?$("[data-loader]").removeClass("hidden"):$("[data-loader]").addClass("hidden")};$(document).ready(function(){$(document).on("click","#btn-filter",function(o){o.preventDefault(),$("#productPrices-table").removeClass("hidden").addClass("display"),$("#productPrices-table").DataTable().destroy(),c(!0);let t={product_brand_id:$("#product_brand_id").val()||null,product_category_id:$("#product_category_id").val()||null,product_subcategory_id:$("#product_subcategory_id").val()||null,is_featured:$("#is_featured").is(":checked")?1:0,with_freight:$("#with_freight").is(":checked")?1:0};$("#productPrices-table").DataTable({...d,pageLength:-1,ajax:{...d.ajax,url:url_route,data:t,error:s=>{$("#btn-update").removeClass("display").addClass("hidden"),c(!1),r.error("Lo sentimos, la tabla no pudo ser cargada","Es necesario contactar a un administrador.")}},columns:[...d.columns,{data:"title"},{data:"category"},{data:"subcategory"},{data:"brand"},{data:"old_price"},{data:"new_price"}],drawCallback:s=>{$("#price_change_controller").removeClass("hidden").addClass("display"),$("#btn-update-wrapper").removeClass("hidden").addClass("display"),c(!1)}})}),$(document).on("click","#btn-change-prices",function(o){o.preventDefault();let t=parseFloat($("#change_value").val());$.each($('[data-price-type="new_price"]'),function(s){let a=0,e=parseFloat($(this).attr("data-original-price"));switch(e=e>0?e:0,$("#change_type").val()){case"fixed_more":a=e+t;break;case"fixed_less":a=e-t;break;case"percentage_more":a=e+t*e/100;break;case"percentage_less":a=e-t*e/100;break}a=a<=0?0:a,$(this).val(a.toFixed(2))})}),$(document).on("change","#new_prices",function(o){$("#upload-button-wrapper").removeClass("hidden")}),$(document).on("click","#btn-download",function(o){c(!0);let t={product_brand_id:$("#product_brand_id").val()||null,product_category_id:$("#product_category_id").val()||null,product_subcategory_id:$("#product_subcategory_id").val()||null,is_featured:$("#is_featured").is(":checked")?1:0,with_freight:$("#with_freight").is(":checked")?1:0};n.post(generate_massive_file_route,t).then(({status:s,data:a})=>{if(s!==200){r.error("Ocurrió un error al general el documento","Por favor vuelve a intentarlo");return}r.confirm("El archivo se ha generado correctamente. ¿Desea descargarlo?",()=>window.open("../"+a,"_blank"),"Archivo Listo")}).catch(s=>{r.error(s.code+": "+s.message,"Lo sentimos, no se pudo descargar el archivo.")}).finally(()=>c(!1))}),$(document).on("click","#btn-upload",function(o){c(!0);const t=new FormData,s=document.querySelector("#new_prices");t.append("new_prices",s.files[0]),r.confirm("Vas a actualizar los precios, esta acción no se puede revertir",a=>{n.post(update_massive_file_route,t,{headers:{"Content-Type":"multipart/form-data"}}).then(({status:e,data:i})=>{if(i.success){r.success(i.message),$("#new_prices").val("").change(),$('label[for="new_prices"]').find(".metadata").text(""),$('label[for="new_prices"]').find("embed").addClass("hidden"),$('label[for="new_prices"]').find(".svg_load_icon").removeClass("hidden"),$("#upload-button-wrapper").addClass("hidden");return}r.error(i.message)}).catch(e=>{r.error(e.code+": "+e.message,"Lo sentimos, no se pudo cargar el archivo.")}).finally(()=>c(!1))})}),$(document).on("click","#btn-update",function(o){o.preventDefault(),c(!0);let t=[];$.each($('[data-price-type="new_price"]'),function(s){let a=$(this).attr("data-original-id"),e=$(this).val();t.push({id:a,price:e})}),r.confirm(`Vas a actualizar ${t.length} precios, esta acción no se podrá revertir`,s=>{n.post(update_massive_route,{dataset:t}).then(({status:a,data:e})=>{if(e.success){$("#btn-filter").click(),r.success(e.message);return}r.error(e.message)}).catch(a=>{r.error(a.code+": "+a.message,"Lo sentimos, no se pudieron actualizar los precios.")}).finally(()=>c(!1))})})});
